import pandas as pd
import jieba
from wordcloud import WordCloud
import matplotlib.pyplot as plt
from collections import Counter

# åŠ è½½è¯„è®ºæ•°æ®
path = "D:\data\smartphone-design-pricing\data\\tmall_782189145082_comments.csv"

df = pd.read_csv(path)

# è‡ªå®šä¹‰åœç”¨è¯è¡¨ï¼ˆå¯æ‹“å±•ï¼‰
STOPWORDS = set([
    "æˆ‘", "æ˜¯", "äº†", "çš„", "åœ¨", "è¿™", "ä¹Ÿ", "å°±", "å’Œ", "ä¸", "éƒ½", "å¾ˆ", "ç”¨", "æœ‰",
    "æ²¡æœ‰", "ä¸€ä¸ª", "ç”¨æˆ·", "ä½¿ç”¨", "å°±æ˜¯", "è¯„ä»·", "å¡«å†™", "æ­¤", "è¿˜", "ç°åœ¨",
    "å¯ä»¥", "éå¸¸", "æ‰‹æœº", "åä¸º", "ä¸œè¥¿", "æ„Ÿè§‰", "çœŸçš„", "æ¥è¯´", "ä½†æ˜¯", "æ‰€ä»¥", "è¯„è®º", 
    "å°¤å…¶", "è¿˜æ˜¯", "ä¸èƒ½", "æœ‰ç‚¹", "åˆ°æ‰‹", "è€Œä¸”", "ä¸åˆ°", "å…¶ä»–", "è¿™ä¹ˆ", "è‡ªå·±", "ä¸äº†", 
    "é™¤äº†", "é¦–å…ˆ", "å“ˆå“ˆå“ˆ", "æ— è®ºæ˜¯", "çœ‹åˆ°", "ç¡®å®", "çš„è¯", "å› ä¸º", "é‚£ä¹ˆ", "å„ç§", "ä¹‹å",
    "è§‰å¾—", "ç½‘ä¸Š", "ä¸€æ¬¡", "å‡ºæ¥", "å¸Œæœ›", "å®Œå…¨", "ç›´æ¥", "æ›´æ˜¯", "æ–¹é¢", "è¿˜æœ‰", "ä¸é”™", "è¿™ä¸ª", "é—®é¢˜", "å®¢æˆ·", "ä¹‹å‰", "æ”¯æŒ", "ç…§ç‰‡", "é€‰æ‹©", "ç‰©æµ", "å¹³å°", "å‘è´§",
    "ä¹‹å", "è´­ç‰©", "æ”¶åˆ°", "æœåŠ¡", "æ‹æ‘„", "æ——èˆ°åº—", "äº§å“", "ç³»åˆ—", "å“ç‰Œ", "å¥½è¯„", "æ»¡æ„",
    "æ¸…æ™°åº¦", "ç…§ç‰‡", "æ˜¾ç¤º", "é¢œè‰²", "æ“ä½œ", "æ•´ä½“", "å·®è¯„", "å¿«é€’", "é€è´§", "åŠŸèƒ½", "æ—¶é—´",
    "æ”¶åˆ°è´§", "ä¹°çš„", "æ€§ä»·æ¯”", "ä½¿ç”¨ä¸­", "ä¸€ä¸‹", "ä¹‹å", "æ•´ä½“", "ä¸€æ ·", "ä¸€æ¬¡", "ç›®å‰","è‹¹æœ",
    "åŒå","å°ç±³","ä¸æ˜¯","å‡ºç°","ä¸€ç‚¹","ä¸å¦‚","èµ·æ¥","ç‰¹åˆ«","ä¸€ç›´","è¿è¡Œ","æ•ˆæœ","ä½“éªŒ","å¾ˆå¿«","å‡ å¤©",
    "è´­ä¹°","ä¸€å¤©"
])

# åˆ†è¯
text = " ".join(df["content"].dropna().astype(str).tolist())
words = jieba.lcut(text)

# è¿‡æ»¤åœç”¨è¯å’Œé•¿åº¦å°äº2çš„è¯
filtered_words = [w for w in words if w not in STOPWORDS and len(w) > 1]

# é«˜é¢‘è¯ç»Ÿè®¡ï¼ˆå¯é€‰æŸ¥çœ‹å‰2Â·0ä¸ªï¼‰
top_words = Counter(filtered_words).most_common(20)
print("ğŸ” é«˜é¢‘è¯ TOP20ï¼š")
for word, count in top_words:
    print(f"{word}: {count}")

# ç”Ÿæˆè¯äº‘
wc = WordCloud(
    font_path="simhei.ttf",
    width=800,
    height=400,
    background_color="white"
).generate(" ".join(filtered_words))

# æ˜¾ç¤ºè¯äº‘
plt.figure(figsize=(10, 5))
plt.imshow(wc, interpolation="bilinear")
plt.axis("off")
#plt.title("æ¸…æ´—åå…³é”®è¯è¯äº‘")
plt.tight_layout()
plt.show()

# ä¿å­˜è¯äº‘å›¾
wc.to_file("cleaned_wordcloud.png")
print("âœ… è¯äº‘å›¾å·²ä¿å­˜ä¸º cleaned_wordcloud.png")
